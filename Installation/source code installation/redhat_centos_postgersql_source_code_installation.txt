First we have to create directory.
mkdir postgresql-15

1.
wget https://ftp.postgresql.org/pub/source/v15.7/postgresql-15.7.tar.gz

2.tar -xzvf postgresql-15.3.tar.gz

3.cd postgresql-15.3

sudo adduser postgres

4. add readline & zlib & xml:- 

yum install readline-devel       -y
yum install epel-release         -y
yum install gcc                  -y
yum install zlib-devel           -y
yum install zlib          -y
yum install libxml2 libxml2-dev  -y
yum install libxslt libxslt-dev  -y
yum install openldap-devel       -y
sudo yum install libuuid-devel -y
sudo yum install ossp-uuid-devel -y
sudo yum install libxml2-devel -y
sudo yum install libxslt-devel -y

sudo yum groupinstall -y "Development Tools"
sudo yum install -y readline-devel
sudo yum install -y zlib-devel
sudo yum install -y openldap-devel
sudo yum install -y libxml2
sudo yum install -y libxml2-devel
sudo yum install -y libxslt-devel

==========================configure: error: ICU library not found===========================

sudo yum install libicu libicu-devel



5. configure & make :- 

./configure  --prefix=/usr/lib/pgsql-16.6  --with-ldap --with-libxml --with-libxslt --with-uuid=e2fs

./configure --prefix=/usr/lib/pgsql-15.11 --with-ldap --with-libxml --with-libxslt --with-openssl --with-uuid=e2fs

make 

make install

6. configure contrib package:- 

make && make install


7.create data_directory:- 

makdir -p /application/postgresql-15/data----------------------------------------------------(data directory)

chown -R postgres:postgres  /application
chmod -R  750 /application/postgresql-15/data


8.switch user:- 

sudo su - postgres

9.create database cluster:- 

/usr/lib/pgsql-15.3/bin/initdb -D /application/postgresql-15/data

10. start postgres service:- 

/usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data  start -l log_file

11.install postgresql-client:-

apt -y  install postgresql-client-common
apt -y install postgresql-client-14 
 
12. if required create sockat file:- 

cd /var/run/
mkdir postgresql
chown postgres:postgres  postgresql
chmod -R 2775 postgresql 

add parameter on postgres config file:- 

vi postgresql.conf

unix_socket_directories = '/var/run/postgresql'
external_pid_file = '/var/run/postgresql/15-main.pid' 


13.create bash profile(env):-
 
vi .bash_profile ----------------------------------(postgres,root user)
# Get the aliases and functions
if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi

# User specific environment and startup programs

PATH=/usr/pgsql-15/bin:$PATH:$HOME/.local/bin:$HOME/bin ------------------------- to see this [postgres@rhel-cmp-postgres-slave ~]

export PATH


export PATH=/usr/lib/pgsql-15.7/bin:$PATH
export PGDATA=/datadrive/data
export PGPORT=5432
export PGDATABASE=postgres
export PGHOST=/tmp

source .bash_profile -----------------------------------(postgres,root user)

14.create postgresql service file:- 

vi /etc/systemd/system/postgresql-15.service

[Unit]
Description=PostgreSQL Database Server
After=network.target

[Service]
Type=forking
User=postgres
ExecStart=/usr/lib/pgsql-15.7/bin/pg_ctl -D /datadrive/data start
ExecStop=/usr/lib/pgsql-15.7/bin/pg_ctl -D /datadrive/data stop
ExecReload=/usr/lib/pgsql-15.7/bin/pg_ctl -D /datadrive/data reload
#PIDFile=/run/postgresql/15-main.pid
TimeoutSec=10

[Install]
WantedBy=multi-user.target


systemctl daemon-reload
systemctl enable postgresql-15.service
systemctl start postgresql-15.service

15. configure log parameter on postgersql configuration file:- 
 
vi postgresql.conf:-
 
log_directory- ‘/data/postgresql-15/data/log’ 
logging_collector-on and open log_rotation_age=7d
log_destination = 'stderr'
log_rotation_size = 10MB 


postgresql client:- 

sudo yum install -y postgresql14



# .bash_profile

# Get the aliases and functions
if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi

# User specific environment and startup programs

PATH=/usr/pgsql-15/bin:$PATH:$HOME/.local/bin:$HOME/bin

export PATH









