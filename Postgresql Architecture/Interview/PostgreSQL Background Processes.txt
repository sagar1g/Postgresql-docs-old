PostgreSQL Background Processes (High-level)

рдЬреЗрд╡реНрд╣рд╛ PostgreSQL instance рд╕реБрд░реВ рд╣реЛрддрдВ, рддреЗрд╡реНрд╣рд╛ рдХрд╛рд╣реА mandatory background processes рд╕реБрд░реВ рд╣реЛрддрд╛рдд.
рддреНрдпрд╛рдВрдЪреЗ рдХрд╛рдо database рдЪреЗ health, performance рдЖрдгрд┐ reliability maintain рдХрд░рдгрдВ рдЕрд╕рддрдВ.

рдореБрдЦреНрдп processes:

Postgres Server Process тЖТ client connections handle рдХрд░рддреЛ (рдкреНрд░рддреНрдпреЗрдХ client рд╕рд╛рдареА рдирд╡рд╛ process fork рд╣реЛрддреЛ).

Background Writer тЖТ dirty pages рд╣рд│реВрд╣рд│реВ disk рд╡рд░ flush рдХрд░рддреЛ.

Checkpointer тЖТ checkpoint record рд▓рд┐рд╣реВрди рдореЛрдареНрдпрд╛ рдкреНрд░рдорд╛рдгрд╛рд╡рд░ dirty pages flush рдХрд░рддреЛ.

WAL Writer тЖТ WAL (Write Ahead Log) buffer disk рд╡рд░ рд▓рд┐рд╣рд┐рддреЛ.

Autovacuum Launcher + Workers тЖТ dead tuples рд╕рд╛рдл рдХрд░рддрд╛рдд (vacuum).

Archiver тЖТ WAL logs archive рдХрд░рддреЛ (backup, PITR рд╕рд╛рдареА).

Stats Collector / PgStat тЖТ database activity statistics рдЬрдорд╛ рдХрд░рддреЛ.

Logical Replication Launcher тЖТ replication jobs рдЪрд╛рд▓рд╡рддреЛ (рдЬрд░ configure рдЕрд╕реЗрд▓ рддрд░).

Syslogger тЖТ logs manage рдХрд░рддреЛ.

ЁЯФ╣ рдЖрддрд╛ "dirty pages" context рдордзреНрдпреЗ рд╣реЗ processes рдХрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛рдд:
1. WAL Writer

рдЬреЗрд╡реНрд╣рд╛ tuple update/delete рд╣реЛрддреЗ тЖТ change рдкреНрд░рдердо WAL buffer рдордзреНрдпреЗ рдЬрд╛рддреЛ.

WAL writer рд╣рд╛ buffer рд╕рддрдд disk рд╡рд░ (pg_wal directory рдордзреНрдпреЗ) flush рдХрд░рддреЛ.
ЁЯСЙ рд╣реЗ data safety рд╕рд╛рдареА: crash рдЭрд╛рд▓рдВ рддрд░реА WAL рдордзреВрди recovery рдХрд░рддрд╛ рдпреЗрдИрд▓.

2. Background Writer

рдЬреЗрд╡реНрд╣рд╛ рдмрджрд▓ RAM рдордзреНрдпреЗ (shared buffer рдордзреНрдпреЗ) рд╣реЛрддреЛ тЖТ рддреНрдпрд╛ page рд▓рд╛ "dirty" flag рдорд┐рд│рддреЛ.

Background writer рджрд░ 200ms рд▓рд╛ wake рд╣реЛрдКрди рдереЛрдбреЗ dirty pages disk рд╡рд░ flush рдХрд░рддреЛ.
ЁЯСЙ рд╣реЗ рдХрд╛рд░рдг: checkpoint рд╡реЗрд│реА рдПрдХрджрдо рдЦреВрдк load рдпреЗрдК рдирдпреЗ.

3. Checkpointer

рдкреНрд░рддреНрдпреЗрдХ checkpoint рд╡реЗрд│реА:

WAL рдордзреНрдпреЗ checkpoint record рд▓рд┐рд╣рд┐рддреЛ тЖТ тАЬрдпрд╛ рдкреЙрдИрдВрдЯрдкрд░реНрдпрдВрддрдЪреЗ рдмрджрд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рдЭрд╛рд▓реЗ рдЖрд╣реЗрддтАЭ.

рдордЧ рддреНрдпрд╛ рдкреЙрдИрдВрдЯрдкрд░реНрдпрдВрддрдЪреА рд╕рдЧрд│реА dirty pages disk рд╡рд░ рд▓рд┐рд╣реВрди рдЯрд╛рдХрддреЛ.
ЁЯСЙ рдЕрдЪрд╛рдирдХ рдореЛрдардВ writing рд╣реЛрддрдВ (рдЬрд░ background writer рдиреЗ рдЬрд╛рд╕реНрдд рдорджрдд рдХреЗрд▓реА рдирд╕реЗрд▓ рддрд░).

4. Autovacuum Workers

рдЬреЗрд╡реНрд╣рд╛ tuples delete рдХрд┐рдВрд╡рд╛ update рд╣реЛрддрд╛рдд тЖТ рдЬреБрдиреЗ tuples "dead" рд╣реЛрддрд╛рдд (рдкрдг disk рд╡рд░ рдЬрд╛рдЧрд╛ рдШреЗрддрд╛рдд).

Autovacuum process рд╣реЗ dead tuples рдХрд╛рдвреВрди рдЯрд╛рдХрддреЛ.

рдпрд╛рдореБрд│реЗ bloat рдХрдореА рд╣реЛрддрдВ рдЖрдгрд┐ future queries fast рд░рд╛рд╣рддрд╛рдд.

ЁЯСЙ Example:

рдЬрд░ autovacuum рдмрдВрдж рдЕрд╕реЗрд▓ тЖТ millions of dead tuples рдЬрдорд╛ рд╣реЛрддреАрд▓ тЖТ queries slow тЖТ disk usage рд╡рд╛рдвреЗрд▓.

5. Archiver

рдЬрд░ WAL archiving enabled рдЕрд╕реЗрд▓ (archive_mode = on) тЖТ WAL files archive рдХрд░реВрди safe location рд▓рд╛ рдкрд╛рдард╡рддреЛ (backup, DR рд╕рд╛рдареА).

6. Stats Collector

рдкреНрд░рддреНрдпреЗрдХ query execution, table usage, tuple insert/update/delete рдЪреА рдорд╛рд╣рд┐рддреА рдЧреЛрд│рд╛ рдХрд░рддреЛ.

Autovacuum decisions, query planner cost calculations рд╕рд╛рдареА statistics рд╡рд╛рдкрд░рд▓реА рдЬрд╛рддрд╛рдд.

ЁЯФ╣ Example Case тАФ рд╕рд░реНрд╡ processes рдПрдХрддреНрд░ рдХрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛рдд?

рд╕рдордЬрд╛ рдПрдХ banking application рдордзреНрдпреЗ transactions рдЯреЗрдмрд▓рд╡рд░ heavy load рдЖрд╣реЗ:

User transaction insert рдХрд░рддреЛ тЖТ

Change RAM (shared buffer) рдордзреНрдпреЗ dirty page рдореНрд╣рдгреВрди рдЬрд╛рддрдВ.

WAL record рддрдпрд╛рд░ рд╣реЛрддреЛ (WAL writer disk рд╡рд░ рд▓рд┐рд╣рд┐рддреЛ).

Background writer тЖТ рд╕рддрдд рдХрд╛рд╣реА dirty pages рдбрд┐рд╕реНрдХрд╡рд░ рдЯрд╛рдХрддреЛ.

Checkpoint рдпреЗрддреЛ тЖТ рдЙрд░рд▓реЗрд▓реА dirty pages рд╕рдЧрд│реА рдбрд┐рд╕реНрдХрд╡рд░ рд▓рд┐рд╣рд┐рд▓реА рдЬрд╛рддрд╛рдд.

Delete / Update рдореБрд│реЗ рдЬреБрдиреНрдпрд╛ tuples dead рдЭрд╛рд▓реЗ тЖТ

Autovacuum worker рдЪрд╛рд▓рддреЛ тЖТ dead tuples рд╕рд╛рдл рдХрд░рддреЛ.

Archiver тЖТ checkpoint рдирдВрддрд░рдЪреЗ WAL logs archive рдордзреНрдпреЗ рдкрд╛рдард╡рддреЛ.

Stats collector тЖТ рдХрд┐рддреА inserts/deletes рдЭрд╛рд▓реЗ, рдХрд┐рддреА dead tuples рдЖрд╣реЗрдд, рд╣реЗ data track рдХрд░рддреЛ.

ЁЯФ╣ Marathi Analogy (рдШрд░рдЧреБрддреА рдЙрджрд╛рд╣рд░рдг)

WAL Writer = рддреБрдореНрд╣реА notebook рдордзреНрдпреЗ рд▓рдЧреЗрдЪ notes рд▓рд┐рд╣реВрди рдареЗрд╡рддрд╛ (рдХрд╛рд╣реА рд╡рд┐рд╕рд░рд▓рд╛рдд рддрд░реА safe).

Background Writer = рд░реЛрдЬ рдереЛрдбреЗ рдереЛрдбреЗ papers cupboard рдордзреНрдпреЗ рдареЗрд╡рдгрд╛рд░рд╛ clerk.

Checkpointer = рдорд╣рд┐рдиреНрдпрд╛рдЪреНрдпрд╛ рд╢реЗрд╡рдЯреА рдмреЙрд╕ audit рдХрд░рддреЛ рдЖрдгрд┐ рд╕рд╛рдВрдЧрддреЛ тАЬрд╕рдЧрд│рдВ рдЖрддрд╛ cupboard рдордзреНрдпреЗ рдареЗрд╡рд╛тАЭ.

Autovacuum = рд╕рдлрд╛рдИ рдХрд╛рдордЧрд╛рд░ тЖТ рдЬреБрдиреЗ, рдирдХреЛрд╕реЗ papers рдХрд╛рдвреВрди рдЯрд╛рдХрддреЛ.

Archiver = рддреБрдордЪреА рдЖрдИ тЖТ рдорд╣рддреНрд╡рд╛рдЪреА papers photocopy рдХрд░реВрди рджреБрд╕рд▒реНрдпрд╛ safe cupboard рдордзреНрдпреЗ рдареЗрд╡рддреЗ.

Stats Collector = attendance register тЖТ рдХреЛрдг рдХрд┐рддреА рдХрд╛рдо рдХрд░рддрдВрдп рдпрд╛рдЪреА рдиреЛрдВрдж рдареЗрд╡рддреЛ.

ЁЯФ╣ рд╕рд╛рд░рд╛рдВрд╢

Checkpointer + Background Writer тЖТ dirty pages manage рдХрд░рддрд╛рдд.

WAL Writer + Archiver тЖТ data durability рдЖрдгрд┐ recovery handle рдХрд░рддрд╛рдд.

Autovacuum тЖТ dead tuples рд╕рд╛рдл рдХрд░реВрди рдЬрд╛рдЧрд╛ рд░рд┐рдХрд╛рдореА рдареЗрд╡рддреЛ.

Stats Collector тЖТ database рд▓рд╛ self-tuning рд╕рд╛рдареА information рджреЗрддреЛ.